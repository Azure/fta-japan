# 4. ネットワークアーキテクチャー事例

本章ではよくあるネットワークのアーキテクチャーを紹介します。

## シナリオ 1: Web サーバーの Azure への移行

インターネットからのアクセスが必要な Web サーバーを Azure へ移行するシナリオです。

### 要件

- インターネットから接続される Web サーバーと、それらのサーバーを管理する管理用のサーバー(CMS)、CMS がデータを保存するデータベース、踏み台サーバーが存在します
- Web サーバーと CMS のサーバー間(東西間)の通信は一方向(CMS サーバー→Web サーバー)です
- CMS サーバーは OS の更新やミドルウェアの更新のためにインターネットへの接続が必要です
- それぞれのサーバーへはオンプレミスの環境から接続する必要があります
  - オンプレミス → CMS サーバーの HTTP通信は許可します
  - オンプレミス → Web サーバーや CMS サーバーに対する管理アクセスは拒否します
  - オンプレミスから Web サーバーや CMS サーバーへ管理アクセスするには踏み台サーバーを利用します

### 設計のポイント

- トポロジ と 接続方法
  - ハブアンドスポーク構成を採用し、共有リソースと Web サービスを提供するネットワークを分離しています
    - 2 つのネットワーク間はピアリングで接続します
  - インターネットとの接続(南北間の通信)は Application Gateway を利用します
  - オンプレミスネットワークとの接続は ExpressRoute のプライベートピアリングを使用します
- セキュリティ
  - サービスを提供する東西間の通信(Web サーバーと管理用のサーバー)は、サブネットを分割して通信を制御します
    - Web サーバー → 管理用サーバーへの通信はすべて拒否します
    - 管理用サーバー → Web サーバーへの通信は HTTPS(443番ポート) のみ許可します
  - CMS サーバーや踏み台サーバーのような内部向けのサーバーからの発信は Azure Firewall を通過させ、インターネットへの通信を制御します
  - NSG フロー ログを有効にしてネットワークフローを監視します
- リソース構成
  - 2 つのサブスクリプションを作成し、それぞれ共有リソースと Web サービスのリソースを配置します
    - 共有リソース用のサブスクリプションには、ExpressRoute 回線、VPN Gateway、Azure Firewall、Log Analytics を配置します
  - 共有リソースのネットワークには踏み台サーバーを展開します

### 改善できるポイント

- Web サーバーからインターネットへの接続についても Azure Firewall を利用できます
- Azure Bastion を利用して踏み台サーバーの代わりに利用できます

## シナリオ 2: オンプレミス環境の業務サーバーの移行

### 要件

- インターネットから接続される メールサーバーや AD FS、WAP サーバーを移行します
- 海外の支店(東南アジア)が存在しており、そのオンプレミス環境から一部の社内向けサービスを移行します
  - 日本拠点から海外拠点に管理用途のアクセスが必要です
- オンプレミス環境にはドメイン コントローラーが存在します
- 社内向けサービスをホストする IIS サーバーの一部を移行します
- データベースは PaaS の SQL Database を利用します
- オンプレミス環境には、SQL Database を利用するサーバーが存在します

### 設計のポイント

- トポロジ と 接続方法
  - ハブアンドスポーク構成を採用し、東日本の共有リソースの一部を東南アジアからも利用できるようにします
    - ハブネットワークは東日本に展開します
  - リージョン間はピアリングで接続します
  - オンプレミス環境からの接続は東日本に展開した ExpressRoute を利用します
    - ハブネットワークに VPN Gateway を展開します

### 改善できるポイント
