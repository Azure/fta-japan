# 3. Azure の監視の実装 <!-- no toc -->

本章では、サンプルのシナリオを用意し、Azure の監視を実装する方法を紹介します。

## 目次 <!-- omit in toc -->

- [3. Azure の監視の実装](#3-azure-の監視の実装)
  - [3.1. シナリオ](#31-シナリオ)
  - [3.2. 監視の実装](#32-監視の実装)
    - [アプリケーション](#アプリケーション)
    - [サーバー](#サーバー)
    - [ネットワーク](#ネットワーク)
    - [セキュリティ](#セキュリティ)
    - [Azure AD](#azure-ad)
    - [サブスクリプション](#サブスクリプション)
    - [コスト](#コスト)

## 3.1. シナリオ

- 想定するストーリー
  - オンプレミスにあるサーバー群を Azure に移行しそれらのサーバーを監視する
- ワークロードと利用するサービス
  - 仮想マシン
    - Web サーバー(企業の Web サイト)
    - DB サーバー(Web サーバーのバックエンド DB)
    - ファイルサーバー
    - 業務システムで利用するそのほかのサーバー
  - Application Gateway
    - Web サーバーのフロントに配置しインターネットからのアクセスを制御する
  - Azure Firewall
    - サーバーからのデータ送信を制御する
- ネットワーク
  - ハブアンドスポーク構成
  - ハブに Azure Firewall と ExpressRoute Gateway を配置
  - 外部との接続が必要なWeb サーバーとそのほかのサーバーは VNet を分割

## 3.2. 監視の実装

### アプリケーション

今回のシナリオでは、Web サーバーにホストされたアプリケーションを対象として考えます。Web サーバーは、インターネットに公開された企業の Web サイトをホストします。

企業の Web サイトであることから、SLA は特にないものとします。しかし、Web サイトがダウンすることは企業イメージへの悪影響を与えることが考えられることから、SLI/SLO を設けることとします。

Web アプリケーションの SLI の一例を以下に挙げます。

|SLI|SLO|
|:---|:---|
|HTTP ステータスコードが 200 以外の割合|0.1 %以下|
|レスポンスにかかる時間が 100 msec以上の割合|0.1 %以下|

Azure では、アプリケーションの監視として、Application Insights が利用できます。フロントエンドやバックエンドのアプリケーションにコードを埋め込むことで APM を実装できます。また、ブラックボックス監視として、可用性テストが利用できます。

可用性テストは、アプリケーションに変更を加えることなく、パフォーマンスやエラーを簡易的にテストできるサービスです。アラートも設定可能です。

### サーバー

サーバーの監視は、Azure Monitor によるメトリックとログをもとに行います。Azure Monitor を利用すると以下の項目を監視できます。

- 仮想マシンホストのメトリック
- 仮想マシンの OS メトリック
- 仮想マシンの OS ログ



### ネットワーク

### セキュリティ

### Azure AD

### サブスクリプション

### コスト